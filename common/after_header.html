<script type="text/discourse-plugin" version="0.8">
  console.log('=== Simple Announcement Banner Debug ===');
  console.log('Script loaded!');
  console.log('Settings object:', settings);
  console.log('announcement_enabled:', settings.announcement_enabled);
  console.log('announcement_topic_url:', settings.announcement_topic_url);
  console.log('announcement_title:', settings.announcement_title);
  
  api.onPageChange(() => {
    console.log('--- Page Change Detected ---');
    console.log('Current path:', window.location.pathname);
    
    // Remove any existing announcement
    const existing = document.querySelector('.simple-announcement-card');
    if (existing) {
      console.log('Removing existing banner');
      existing.remove();
    }
    
    // Check if we should show the banner
    if (!settings.announcement_enabled) {
      console.log('Banner is disabled in settings');
      return;
    }
    
    if (!settings.announcement_topic_url) {
      console.log('No topic URL configured');
      return;
    }
    
    // Check page visibility settings
    const currentPath = window.location.pathname;
    const isHomepage = currentPath === '/' || currentPath.startsWith('/categories');
    console.log('Is homepage?', isHomepage);
    console.log('Show on homepage only?', settings.show_on_homepage_only);
    
    if (settings.show_on_homepage_only && !isHomepage) {
      console.log('Not showing because not on homepage');
      return;
    }
    
    console.log('All checks passed, building banner HTML...');
    
    // Build the announcement HTML
    const thumbnailHtml = settings.announcement_thumbnail 
      ? '<img src="' + settings.announcement_thumbnail + '" class="announcement-thumb" alt="' + settings.announcement_title + '">' 
      : '';
    
    const html = '<div class="simple-announcement-card">' +
      '<a href="' + settings.announcement_topic_url + '" class="announcement-link">' +
        thumbnailHtml +
        '<div class="announcement-content">' +
          '<h3>' + settings.announcement_title + '</h3>' +
          '<p>' + settings.announcement_description + '</p>' +
          '<span class="read-more">Read more â†’</span>' +
        '</div>' +
      '</a>' +
    '</div>';
    
    console.log('Banner HTML built:', html);
    
    // Insert the banner
    const mainOutlet = document.querySelector('#main-outlet');
    console.log('Main outlet found?', !!mainOutlet);
    
    if (mainOutlet) {
      console.log('Inserting banner into page...');
      mainOutlet.insertAdjacentHTML('afterbegin', html);
      console.log('Banner inserted!');
    } else {
      console.log('ERROR: Could not find #main-outlet');
    }
  });
  
  console.log('=== End Banner Debug ===');
</script>
