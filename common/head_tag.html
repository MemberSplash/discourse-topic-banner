<script type="text/discourse-plugin" version="0.8">
  console.log('=== Simple Announcement Banner Loaded ===');
  console.log('Settings:', settings);
  
  api.onPageChange(() => {
    console.log('Page changed:', window.location.pathname);
    
    // Remove any existing announcement
    const existing = document.querySelector('.simple-announcement-card');
    if (existing) existing.remove();
    
    // Check if we should show the banner
    if (!settings.announcement_enabled || !settings.announcement_topic_url) {
      console.log('Banner disabled or no URL');
      return;
    }
    
    // Check page visibility
    const currentPath = window.location.pathname;
    const isHomepage = currentPath === '/' || currentPath.startsWith('/categories');
    
    if (settings.show_on_homepage_only && !isHomepage) {
      console.log('Not showing - not homepage');
      return;
    }
    
    console.log('Building banner...');
    
    // Build HTML
    const thumbnailHtml = settings.announcement_thumbnail 
      ? '<img src="' + settings.announcement_thumbnail + '" class="announcement-thumb" alt="Announcement">' 
      : '';
    
    const html = '<div class="simple-announcement-card">' +
      '<a href="' + settings.announcement_topic_url + '" class="announcement-link">' +
        thumbnailHtml +
        '<div class="announcement-content">' +
          '<h3>' + settings.announcement_title + '</h3>' +
          '<p>' + settings.announcement_description + '</p>' +
          '<span class="read-more">Read more â†’</span>' +
        '</div>' +
      '</a>' +
    '</div>';
    
    // Insert banner
    const mainOutlet = document.querySelector('#main-outlet');
    if (mainOutlet) {
      mainOutlet.insertAdjacentHTML('afterbegin', html);
      console.log('Banner inserted!');
    } else {
      console.log('No #main-outlet found');
    }
  });
</script>
